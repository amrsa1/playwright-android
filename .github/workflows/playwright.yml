name: Playwright Tests
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
jobs:
  test:
    timeout-minutes: 60
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: Build docker image
      run: docker build --platform windows/amd64 -t playwright 

    - name: Initialize container
      run: docker run --privileged -td --name android playwright
  

    - name: Prepare emulator & execute the test
      run: |
            docker exec -t --privileged android bash -c "./start_emu_headless.sh && npm run test"
    
    # - name: Run Playwright tests
    #   run: npx playwright test
    # - uses: actions/upload-artifact@v3
    #   if: always()
    #   with:
    #     name: playwright-report
    #     path: playwright-report/
    #     retention-days: 30
